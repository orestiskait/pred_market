# =============================================================================
# LDM Pattern-Action Configuration — pqact.conf
# =============================================================================
# Defines how incoming data products are processed.
#
# Format:
#   <feedtype>  <product-ID-regex>
#       <action>  <arguments>
#
# Action types:
#   FILE    — write product to a file
#   PIPE    — pipe product to a program's stdin
#
# We use PIPE to send each METAR/SPECI product to our Python ingest script,
# which parses the raw METAR text, filters to tracked stations, and appends
# to parquet files.
# =============================================================================

# ── Surface observations → Python ingest pipeline ───────────────────────────
# Match SA (routine METAR) and SP (SPECI) products from US stations.
# The product identifier looks like: SAUS70 KWBC 191800
#   S  = Surface
#   A  = Aviation (routine) / P = SPECI
#   US = United States
#   70 = WMO designation
#
# Product is piped to ldm_ingest.py which:
#   1. Extracts individual METAR/SPECI lines from the WMO bulletin
#   2. Filters to stations in our STATION_REGISTRY (KMDW, KNYC, etc.)
#   3. Parses temperature, wind, visibility, pressure
#   4. Appends to parquet: data/weather_obs/ldm_surface/<ICAO>_<date>.parquet

IDS|DDPLUS	^SA
	PIPE	/app/venv/bin/python /app/weather/ldm_ingest.py

IDS|DDPLUS	^SP
	PIPE	/app/venv/bin/python /app/weather/ldm_ingest.py

# ── Archive raw products to file (optional, for debugging) ──────────────────
# Uncomment to save raw WMO bulletins to disk for troubleshooting.
# Files are organized by date and station header.
#
# IDS|DDPLUS	^S[AP](..)(..) (....) (..)(..)
# 	FILE	data/ldm_raw/surface/%4/%5%6_\1\2_\3.txt
