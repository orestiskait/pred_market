# =============================================================================
# Docker Compose — Kalshi Collector
# =============================================================================
# Runs collector services on the OCI VM:
#
#   kalshi-collector   — WebSocket-based Kalshi market data collector
#   synoptic-listener  — Synoptic Data WebSocket collector
#   weather-bot        — Weather paper execution bot
#
# Data is persisted to the host directory (~/collector-data).
#
# Usage:
#   docker compose up -d
#   docker compose down
# =============================================================================

services:
  # ── Kalshi market data collector ──────────────────────────────────────────
  kalshi-collector:
    image: kalshi-collector:latest
    container_name: kalshi-collector
    restart: unless-stopped
    env_file:
      - ${SHARED_ENV_FILE:-.env}
    volumes:
      - ${DATA_DIR:-./data}:/app/data
    networks:
      - collector-net

  # ── Synoptic Data WebSocket collector ─────────────────────────────────────
  synoptic-listener:
    image: kalshi-collector:latest
    container_name: synoptic-listener
    restart: unless-stopped
    command: python -m pred_market_src.collector.synoptic.listener
    env_file:
      - ${SHARED_ENV_FILE:-.env}
    volumes:
      - ${DATA_DIR:-./data}:/app/data
    networks:
      - collector-net

  # ── Weather Paper Execution Bot ───────────────────────────────────────────
  weather-bot:
    image: kalshi-collector:latest
    container_name: weather-bot
    restart: unless-stopped
    command: python -m pred_market_src.collector.bot.weather_bot
    env_file:
      - ${SHARED_ENV_FILE:-.env}
    volumes:
      - ${DATA_DIR:-./data}:/app/data
    networks:
      - collector-net

networks:
  collector-net:
    driver: bridge
