# =============================================================================
# Docker Compose — Kalshi listener, Synoptic listener, weather bot
# =============================================================================
# Runs three services:
#
#   kalshi-listener    — Kalshi WebSocket listener (market data, orderbooks)
#   synoptic-listener  — Synoptic WebSocket listener (real-time weather obs)
#   weather-bot        — Weather paper execution bot
#
# Data is persisted to the host directory (~/collector-data).
#
# Usage:
#   docker compose up -d
#   docker compose down
# =============================================================================

services:
  # ── Kalshi market data listener ────────────────────────────────────────────
  kalshi-listener:
    image: kalshi-services:latest
    container_name: kalshi-listener
    restart: unless-stopped
    env_file:
      - ${SHARED_ENV_FILE:-.env}
    volumes:
      - ${DATA_DIR:-../data}:/app/data
    networks:
      - collector-net

  # ── Synoptic listener (WebSocket weather ingest) ─────────────────────────
  synoptic-listener:
    image: kalshi-services:latest
    container_name: synoptic-listener
    restart: unless-stopped
    command: python -m services.synoptic.listener
    env_file:
      - ${SHARED_ENV_FILE:-.env}
    volumes:
      - ${DATA_DIR:-../data}:/app/data
    networks:
      - collector-net

  # ── Weather Paper Execution Bot ───────────────────────────────────────────
  weather-bot:
    image: kalshi-services:latest
    container_name: weather-bot
    restart: unless-stopped
    command: python -m services.bot.weather_bot
    env_file:
      - ${SHARED_ENV_FILE:-.env}
    volumes:
      - ${DATA_DIR:-../data}:/app/data
    networks:
      - collector-net

networks:
  collector-net:
    driver: bridge
